> [Вернуться к содержанию документации](./README.md)

# Руководство по первоначальной настройке проекта

Этот документ — ваш главный путеводитель по развертыванию проекта.
Он описывает все возможные сценарии: от миграции существующего сайта до чистой установки.

> Для ежедневной работы с уже настроенным проектом, пожалуйста, обратитесь к **[Краткому руководству по началу работы](./QUICK_START_RU.md)**.

---

## Требования

-   **Docker**: Необходим для запуска окружения.
-   **Git**: Для клонирования репозитория.
-   **Make**: (Рекомендуется) Для выполнения команд из `Makefile`.
-   **Java (JDK) 21+**: (Опционально) Необходима только для **гибридного режима** разработки (`make run-hybrid`), который удобен для бэкенд-разработчиков. Для фронтенд-разработки или тестирования JDK на локальной машине не требуется.

---

## Первоначальная настройка

Перед выбором сценария выполните эти два шага:

1.  **Клонируйте репозиторий**:
    ```bash
    git clone https://github.com/rkonoplev/phoebe.git
    cd phoebe
    ```

2.  **Создайте файл окружения**:
    ```bash
    cp .env.dev.example .env.dev
    ```
    В большинстве случаев изменять `.env.dev` не требуется.

---

## Выбор сценария развертывания

- **[Сценарий 1: Быстрый старт для нового разработчика (Рекомендуемый)](#сценарий-1-быстрый-старт-для-нового-разработчика-рекомендуемый)**
  - **Цель**: Максимально быстро запустить проект локально с полной, готовой базой данных, которая уже была ранее смигрирована.

- **[Сценарий 2: Чистая установка (новый сайт)](#сценарий-2-чистая-установка-новый-сайт)**
  - **Цель**: Запустить проект без исторических данных, чтобы начать наполнять полностью новый сайт с нуля.

- **[Сценарий 3: Резервное копирование и перенос проекта](#сценарий-3-резервное-копирование-и-перенос-проекта)**
  - **Цель**: Сохранить текущее состояние вашей локальной базы данных для переноса на другой компьютер.

- **[Сценарий 4: Развертывание в продакшен](#сценарий-4-развертывание-в-продакшен)**
  - **Цель**: Развернуть приложение на реальном сервере для публичного доступа.

---

### Сценарий 1: Быстрый старт для нового разработчика (Рекомендуемый)

Этот сценарий предполагает, что вся работа по миграции уже проделана, и вам нужно просто запустить проект с готовой базой данных.

1.  **Выполните** шаги из раздела [Первоначальная настройка](#первоначальная-настройка).

2.  **Выберите режим запуска и выполните команду**:

    -   **Для бэкенд-разработчиков (гибридный режим):**
        Этот режим требует локально установленный JDK, но предоставляет лучшую интеграцию с IDE.
        ```bash
        make run
        ```
        *(Это псевдоним для `make run-hybrid`)*
        *Альтернативная команда (без Makefile):*
        ```bash
        docker compose -f docker-compose.base.yml -f docker-compose.hybrid.yml up --build
        ```

    -   **Для фронтенд-разработчиков и тестировщиков (продакшен-подобный режим):**
        Этот режим не требует ничего, кроме Docker.
        ```bash
        make run-prod
        ```
        *Альтернативная команда (без Makefile):*
        ```bash
        docker compose -f docker-compose.base.yml -f docker-compose.prod.yml up --build
        ```

**Результат**: `Makefile` или `docker compose` запустит необходимые файлы. Docker поднимет все сервисы (базу данных, бэкенд, фронтенд), а Flyway автоматически создаст схему и наполнит ее данными.

---

### Сценарий 2: Чистая установка (новый сайт)

Этот сценарий для тех, кто хочет начать с абсолютно пустой базы данных.

1.  **Отключите миграцию с данными**:
    - Перейдите в `backend/src/main/resources/db/migration/common/`.
    - Найдите скрипт, ответственный за вставку данных (например, `V3__insert_sample_data.sql`).
    - **Переименуйте** его, изменив префикс с `V` на `_V` (например, `_V3__insert_sample_data.sql`).

2.  **Запустите проект** в любом из режимов:
    ```bash
    make run
    ```
    *Альтернативная команда (без Makefile):*
    ```bash
    docker compose -f docker-compose.base.yml -f docker-compose.hybrid.yml up --build
    ```
    *(Или используйте `docker-compose.prod.yml` вместо `docker-compose.hybrid.yml`)*

**Результат**: Flyway создаст все таблицы, но пропустит миграцию с данными. Вы получите чистую базу данных.

---

### Сценарий 3: Резервное копирование и перенос проекта

Этот процесс предназначен для создания "снимков" вашей локальной базы данных для переноса между рабочими машинами.

- Все шаги и команды подробно описаны в **[Руководстве по переносу Docker Volume с данными MySQL](./VOLUME_MIGRATION_GUIDE_RU.md)**.

---

### Сценарий 4: Развертывание в продакшен

Этот сценарий описывает перенос приложения из локальной разработки в "живую" среду (продакшен).
Он включает в себя настройку сервера, управление секретами и использование Docker для развертывания.

Все подробные инструкции, требования к окружению и примеры конфигураций описаны в отдельном руководстве:

- **➡️ [Руководство по развертыванию в продакшене](./PRODUCTION_GUIDE_RU.md)**

---

## Отладка фронтенда

Если бэкенд запущен и работает корректно (доступен по `http://localhost:8080`),
но с фронтендом возникли проблемы, вы можете запустить его вручную для отладки.

### 1. Убедитесь, что бэкенд запущен
Запустите бэкенд и базу данных, используя `make run` или `make run-prod`.

### 2. Запустите выбранный фронтенд вручную

- **Для Next.js фронтенда:**
  1.  Перейдите в директорию: `cd frontends/nextjs`
  2.  Установите зависимости: `npm install`
  3.  Запустите приложение: `npm run dev`
  Приложение будет доступно по адресу `http://localhost:3000`.

### 3. Проверка логов фронтенда

-   **Если запущен через `make`:**
    ```bash
    docker compose logs -f phoebe-nextjs
    ```
-   **Если запущен вручную:**
    Логи будут отображаться непосредственно в терминале, где вы запускали `npm run dev`.
