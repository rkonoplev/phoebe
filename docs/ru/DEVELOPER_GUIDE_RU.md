> [Вернуться к содержанию документации](./README.md)
>
> **[Краткое руководство по началу работы](./QUICK_START_RU.md)**: Краткие инструкции для быстрого старта
> и выполнения повседневных задач с уже настроенным проектом.

# Руководство по ежедневному рабочему процессу

Этот файл описывает, как удобно работать над проектом на локальной машине (IntelliJ IDEA, Gradle, Docker)
и что будет автоматически выполняться в GitHub Actions (CI/CD).

> Для определения ключевых терминов и технологий, пожалуйста, обратитесь к **[Глоссарию](./GLOSSARY_RU.md)**.

---

## Содержание
- [Первоначальная настройка проекта](#первоначальная-настройка-проекта)
- [Выбор режима разработки](#выбор-режима-разработки)
- [Ежедневная работа локально](#ежедневная-работа-локально)
- [Настройка автоформаттера кода](#настройка-автоформаттера-кода)
- [Перед пушем на GitHub](#перед-пушем-на-github)
- [Что делает CI/CD (на GitHub Actions)](#что-делает-cicd-на-github-actions)
- [Итог](#итог)
- [Миграции базы данных (Flyway)](#миграции-базы-данных-flyway)

---

## Первоначальная настройка проекта

Для первого запуска проекта, пожалуйста, обратитесь к
**[Руководству по первоначальной настройке проекта](./SETUP_GUIDE_RU.md)**.

---

## Выбор режима разработки

Проект поддерживает два режима запуска для локальной разработки. Выберите тот, который лучше всего подходит для вашей текущей задачи.

### Режим 1: Гибридный (`make run` или `make run-hybrid`)
- **Для кого:** Идеально для **бэкенд-разработчиков**, активно работающих с Java-кодом.
- **Требования:** Docker и локально установленный JDK.
- **Преимущества:** Позволяет быстро запускать юнит-тесты и использовать все возможности анализа кода прямо в IDE.

### Режим 2: Продакшен-подобный (`make run-prod`)
- **Для кого:** Идеально для **фронтенд-разработчиков, тестировщиков** или для финальной проверки перед коммитом.
- **Требования:** Только Docker.
- **Преимущества:** Не требует установки Java на локальную машину, обеспечивает "чистое" окружение, идентичное CI/CD.

> Подробное сравнение подходов доступно в документе **[Подходы к локальной разработке](./DEVELOPMENT_APPROACHES_RU.md)**.

---

## Ежедневная работа локально

### Рекомендуемый процесс (через Makefile)
Весь основной рабочий процесс построен вокруг `Makefile` для простоты.

- **Запуск полного окружения** (БД + бэкенд + фронтенд):
  ```bash
  # Для бэкенд-разработки (режим по умолчанию)
  make run

  # Для фронтенд-разработки
  make run-prod
  ```
- **Запуск всех тестов** (юнит + интеграционные):
  ```bash
  make all-tests
  ```
- **Остановка окружения**:
  ```bash
  make stop
  ```
> Для полного списка команд см. **[Тестирование и разработка с Makefile](./TESTING_WITH_MAKEFILE_RU.md)**.

### Альтернативный/Низкоуровневый запуск
Команды `make` являются оберткой над `docker-compose` и `gradlew`. Вы можете использовать их напрямую.

- **Запуск только юнит-тестов** (не требует Docker):
  В IDEA или командой:
  ```bash
  cd backend && ./gradlew test
  ```
- **Запуск интеграционных тестов** (требует запущенный Docker):
  ```bash
  cd backend && ./gradlew integrationTest
  ```
- **Запуск приложения вручную** (требует локальный MySQL):
  ```bash
  cd backend && ./gradlew bootRun
  ```

---

## Настройка автоформаттера кода

Проект использует единые настройки форматирования Java-кода с длиной строки **120 символов**.
Конфигурация находится в `.idea/codeStyles/` и автоматически применяется при открытии проекта.

- **Проверьте настройки**: `File → Settings → Editor → Code Style → Scheme = "Project"`.
- **Форматирование кода**: `Ctrl+Alt+L` (Win/Linux) или `Cmd+Alt+L` (Mac).
- **Рекомендуется** включить форматирование при сохранении: `Settings → Tools → Actions on Save → Reformat code`.

---

## Перед пушем на GitHub

**Рекомендуемая проверка:**
```bash
make all-tests
```
Эта команда эмулирует полную проверку в CI.

**Минимум проверки (вручную):**
- Код компилируется (`./gradlew build`).
- Все юнит-тесты проходят (`./gradlew test`).
- Интеграционные тесты проходят (`./gradlew integrationTest`).

---

## Что делает CI/CD (на GitHub Actions)

После пуша будут автоматически выполнены:
- Полная Gradle сборка (`clean build`).
- Запуск всех тестов (`integrationTest`, который включает `test`).
- Статический анализ кода: Checkstyle и PMD (в рамках задачи `build`).
- Отчёт о покрытии тестов (JaCoCo) и загрузка в Codecov.

> **Примечание**: Сканирование на секреты (GitLeaks) больше не является автоматическим шагом в CI
> и рекомендуется для локального запуска.

---

## Итог

- Docker при обычной разработке (написание кода, юнит-тесты) держать не нужно.
- Перед пушем рекомендуется выполнять `make all-tests` для полной уверенности.
- Весь «тяжёлый» анализ и интеграционные тесты будут дополнительно проверены в CI.

---

## Миграции базы данных (Flyway)

Проект использует Flyway для управления изменениями схемы БД. Для поддержки нескольких СУБД (MySQL и PostgreSQL)
скрипты миграций организованы в отдельных директориях.

### Структура директорий
- `src/main/resources/db/migration/common/`: Общие скрипты для всех СУБД.
- `src/main/resources/db/migration/mysql/`: Скрипты только для MySQL.
- `src/main/resources/db/migration/postgresql/`: Скрипты только для PostgreSQL.
