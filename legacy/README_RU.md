> [Вернуться к содержанию документации](./README.md)

# Архивные файлы Docker Compose и конфигурации

**ВНИМАНИЕ:** Эта директория содержит конфигурационные файлы, которые использовались во время миграции
с Drupal 6 на платформу Spring Boot News. Они не используются в текущей разработке и сохранены для
исторической справки.

[English Version](./README.md)

---

## Обзор архивных ресурсов

- **[Скрипты трансформации](./archived_migration_scripts/README_RU.md):** SQL-скрипты, которые преобразовывали сырые данные Drupal.
- **[Оригинальный дамп Drupal 6](./original_drupal_dump/README_RU.md):** Исходный дамп базы данных до начала миграции.

---

## Описание файлов

### `docker-compose.yml` (устаревший)
- **Исходное расположение**: Корневая директория проекта (`/docker-compose.yml`)
- **Описание**: Это был единый файл для запуска всех сервисов (MySQL, бэкенд, фронтенд). Он не предоставлял гибкости для разных режимов разработки.
- **Статус**: УСТАРЕЛ. Заменен на модульную структуру с `docker-compose.base.yml`, `docker-compose.hybrid.yml` и `docker-compose.prod.yml`. Сохранен здесь для истории.

### `legacy-gradle-ci.yml`
Устаревшая версия файла рабочего процесса GitHub Actions (`.github/workflows/gradle-ci.yml`).
- **Ключевые отличия от текущей версии:**
  - **Разделение на несколько `jobs`**: Содержал отдельные работы (`setup`, `build_and_test`, `security`), что делало конвейер медленнее.
  - **Ручное управление БД**: Использовал секцию `services` для явного запуска MySQL контейнера.
  - **Автоматический скан безопасности**: Включал шаг для запуска `gitleaks`.
- **Статус**: УСТАРЕЛ. Сохранен как пример "классического" подхода к настройке CI до внедрения Testcontainers.

### `application-ci.yml`
Устаревший профиль Spring, который использовался в CI.
- **Описание**: Настраивал тесты на использование быстрой базы данных H2 в памяти в режиме совместимости с MySQL.
- **Статус**: УСТАРЕЛ. Заменен профилем `integration-test`, который использует Testcontainers.

### `application-dev.yml`
Устаревший профиль Spring для dev-окружения.
- **Описание**: Был предназначен для dev-стендов или CI, где база данных MySQL предоставлялась внешним Docker-контейнером (`mysql-dev`).
- **Статус**: УСТАРЕЛ. Его роль была объединена с профилем `local` для локальной разработки.

### `DatabaseProperties.java`
Устаревший класс конфигурации Spring Boot, использовавшийся во время миграции с Drupal 6. Этот файл:
- **Исходное расположение**: `backend/src/main/java/com/example/phoebe/config/DatabaseProperties.java`
- Определял кастомные настройки пула соединений с БД для нагрузки во время миграции.
- Увеличивал таймауты соединения для передачи больших объемов данных.
- Включал логирование SQL для отладки миграционных запросов.
- Использовал `@ConfigurationProperties(prefix = "app.database")` для привязки конфигурации.
- **Статус**: УСТАРЕЛ - Миграция завершена, используется стандартная конфигурация datasource от Spring.

### `Makefile`
Устаревшая утилита для тестирования с сокращенными командами для API. Этот файл:
- **Исходное расположение**: Корневая директория проекта (`/Makefile`)
- Предоставлял команды `make test-news-get`, `make test-news-post` для тестирования API.
- Использовал устаревшие эндпоинты (`/api/news` вместо `/api/public/news`).
- Требовал ручной настройки учетных данных через переменные окружения.
- **Статус**: УСТАРЕЛ - Заменен примерами `curl` в документации API и Postman-коллекциями.

### `docker-compose.drupal.yml`
Временная конфигурация Docker Compose для миграции данных Drupal 6. Этот файл:
- **Исходное расположение**: Корневая директория проекта (`/docker-compose.drupal.yml`)
- Запускает MySQL 5.7 для совместимости с устаревшими дампами базы данных Drupal 6.
- Открывает порт MySQL 3307, чтобы избежать конфликтов с основной базой данных приложения.
- Автоматически загружает дампы базы данных из директории `./legacy/original_drupal_dump`.
- Монтирует скрипты миграции из директории `./legacy/archived_migration_scripts`.
- Использует отдельный том `mysql_data_drupal6` для изоляции.

### `docker-compose.override.yml`
Пример конфигурации для продакшн-среды для Docker Compose. Этот файл предоставляет:
- **Исходное расположение**: Корневая директория проекта (`/docker-compose.override.yml`)
- Готовые к продакшену настройки безопасности с использованием Docker secrets для чувствительных данных.
- Проверки состояния (health checks) для сервисов базы данных и приложения.
- Правильные зависимости между сервисами и политики перезапуска.
- Безопасную конфигурацию базы данных без открытия внешних портов.

### `ExampleTest.java`
Устаревший тестовый файл-заглушка из раннего этапа разработки. Этот файл:
- **Исходное расположение**: `backend/src/test/java/com/example/phoebe/ExampleTest.java`
- Простой тест JUnit 5 с утверждением `assertTrue(true)`.
- Был создан как начальная структура тестов при настройке проекта.
- **Статус**: УСТАРЕЛ - Заменен комплексными юнит- и интеграционными тестами.

---

## Контекст миграции

Эти файлы были частью процесса миграции и ранней разработки с устаревшего сайта Drupal 6 на современную
платформу Spring Boot News. Они включают:

- **Специфичные для миграции конфигурации** (файлы Docker Compose для совместимости с Drupal 6)
- **Устаревшие инструменты разработки** (Makefile с устаревшими эндпоинтами API)
- **Классы Spring Boot времен миграции** (кастомные свойства базы данных)

Они сохранены здесь для справки и чтобы помочь разработчикам понять подход к миграции и эволюцию проекта.

### `migrate_volumes.sh` и `rollback_migration.sh`
Скрипты миграции Docker volumes, использовавшиеся при переименовании news-platform → phoebe. Эти файлы:
- **Исходное расположение**: Корневая директория проекта
- Автоматизировали миграцию с контейнеров `news-mysql` на `phoebe-mysql`
- Создавали резервные копии базы данных в `db_dumps/` перед миграцией
- Обновляли `docker-compose.yml` с новыми именами контейнеров
- Исправляли предупреждения MapStruct и контексты сборки Docker
- **Статус**: ЗАВЕРШЕНО - Миграция успешно выполнена, контейнеры переименованы в phoebe-*
- **Создана резервная копия**: `db_dumps/backup_before_migration_*.sql`

---

## Текущий процесс разработки

Для текущей разработки используйте `Makefile` и модульные файлы `docker-compose.*.yml` в корне проекта.